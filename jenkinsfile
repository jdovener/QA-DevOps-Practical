pipeline{
        agent any
        environment {
            app_version = 'v1'
            rollback = 'true'
        }
        stages{
            stage('Run Tests'){
                steps{
                    sh "./test.sh"
                }
            }
            stage('Ansible playbook run'){
                steps{
                    sh "ansible-playbook install_docker.yaml"
                }
            }
            stage('Remove existing images'){
                steps{
                    sh "docker system prune --all --volumes --force"
                }
            }
            stage('Build Images'){
                steps{
                    sh "docker-compose build"
                }
            }
            stage('Push to DockerHub'){
                steps{
                    sh ""
                }
            }
            stage('Deploy App'){
                steps{
                    sh "ssh jimmd@swarm-manager-project2 'docker stack deploy -c docker-compose.yaml'"
                }
            }
        }
}

// run Tests
// ansible playbook run
// remove images
// docker-compose build
// push to dockerhub
// docker swarm deploy 'docker stack deploy -c docker-compose.yaml'